language: java
sudo: false
jdk:
- oraclejdk9
env:
  global:
  - secure: "dYjMF9qjmv85TdhSauKTfU+5Lt7q1ZpOLfpYuRz1yQF3Y+Ru/5/2Ucb4efgzLNRE4u9KGM7MJr1YRH3qV5OyxBqfKZ9ORq5noQbukfKyDDjS7oRn1HiHWG5ZWs2Ja35z0a5BK8+h5OF8kA1C5dmQ/tePKP5JAZZlhwnBolkwUXTJXAvppSBpl2/m/0KBJoHMJYxiY4DJ8grf3OWWhsWO9YMeJAov+N4GFJy9J85tbKvb4XgJITBPrSmK981JS67sddjelaodaolF5vewoW7KfxG87SMRr6xOno0Qy1td2aiUXMt10w2eI2FTluC9Fp0UJ7z3rMEGcHGFjaPXk+bLOAwGwoJq3xt3mA91Y7N1aQuOnWL01K94c7rw9yUU+HUfrUz1iPVEFD36FkwZNFYXHPL8JMuSL6bIafaiu5Nd95QZP7vET3It07zBc/KcV2izdk9aXOOPumKmw/VpzunWfYF2we53uuN1tvzBJ5yxuHjsoteTkbdoYpIinAHI3QfREwwRX19Q4jjJU9GTT12n/7GQopXzuytK6M6xlltVVD/KffmdyiqqWA1u391t2HcgmX6TyvHS4jNy9hbJ+/zfqwZG+NQFSPz99LAiGpLYmctY3A5oofM16x07Tofk/HvbCMCjuMsk0zLgd1m915TFJ5ZUQ510ohrM5IBSdUJ6NUc=" # CODACY_PROJECT_TOKEN
  - secure: "PQ/K3HeqG52aDOel6ROp8vJo1ybfnwjdYKewKssWQwsb38BIPe68RKgJ06mOeyacrf+i1BkJgKspTcwLeMqfRNP+mxAg3WBccG6dwZy3LdeaRBrcGQhiBLgK8RthIFxOPoY4pm2iiUQdcakWXHIqz62asV8Hx9Yk8qyyIch+kj4uEE2bgyJGKb3MM56kPmjOSZIuD+hR3V/RqBBgpKrDsfkEGH5kZSfLlt9oy5tsJsAzlY4cYFq3RBy4KZQUifRXh6i7MHWOSt48E1Qt7hwik0pSchS7AqMAvu3tCstc+hUGavpq/XXqlqH8kWjplpVJQsQ5YUcacDWFxuFpfPTBbFJKITEQrEoXlSNOXMTIzaBdn8CZtCoeIonHMXkAaOncVmEIjFQbOl0XzDNz6GXmUYCoUcWeBhq4rBcFqq844VIUaRbmD+eQR7zDx2B5WcKGt/h273iK7rCBQB3dEOhhab2rliES8FmUKj1U/k50Ae7oVrlnPm6fJH7tCsEKEEgPrvlLEzOtFpqrOeQZ91B+wkopw4d+z+24OBgVpk4Plv6G+CBHU61ixwOJ9MJFEPeZ/2gNWmZkGItS6L0eMqK+SvMYzZETrreceLFWRSzmpRKbWilmauBLKzFNnf9+Emu+XD0boC/oQGwyYGi4Cm1HmSAInGXfvwaDh7d5RHAbh0A=" # BINTRAY_API_KEY
install:
- curl -o $HOME/.m2/settings.xml https://gist.githubusercontent.com/cryptobot/cf5fbd909c4782aaeeeb7c7f4a1a43da/raw/e60ee486e34ee0c79f89f947abe2c83b4290c6bb/settings.xml
- mvn dependency:go-offline -Pdependency-check,coverage,release
before_script:
- mvn --update-snapshots dependency-check:check -Pdependency-check
script:
- mvn clean test jacoco:report verify -Pcoverage
after_success:
- jdk_switcher use oraclejdk8
- curl -o ~/codacy-coverage-reporter-assembly-latest.jar https://oss.sonatype.org/service/local/repositories/releases/content/com/codacy/codacy-coverage-reporter/4.0.1/codacy-coverage-reporter-4.0.1-assembly.jar
- $JAVA_HOME/bin/java -jar ~/codacy-coverage-reporter-assembly-latest.jar report -l Java -r target/site/jacoco/jacoco.xml
cache:
  directories:
  - $HOME/.m2
before_deploy:
- jdk_switcher use oraclejdk9
deploy:
- provider: script # SNAPSHOTS
  script: mvn clean deploy -DskipTests -Prelease
  skip_cleanup: true
  on:
    repo: cryptomator/siv-mode
    branch: develop
    condition: $TRAVIS_TAG = ''
- provider: script # RELEASES
  script: mvn clean versions:set -DnewVersion=${TRAVIS_TAG} deploy -DskipTests -Prelease
  skip_cleanup: true
  on:
    repo: cryptomator/siv-mode
    tags: true
after_deploy:
  - "echo '{\"close\": \"1\"}' | curl -v -X POST -u cryptobot:${BINTRAY_API_KEY} https://api.bintray.com/maven_central_sync/cryptomator/maven/siv-mode/versions/${TRAVIS_TAG}"